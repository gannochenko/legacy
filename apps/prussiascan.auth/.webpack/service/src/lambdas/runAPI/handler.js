(()=>{"use strict";var e={368:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationTokenEntity=void 0,t.InvitationTokenEntity=class{}},960:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(368),t)},58:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.UserRoleEnum=void 0,(o=t.UserRoleEnum||(t.UserRoleEnum={})).admin="admin",o.contributor="contributor",o.cicd="cicd"},422:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(58),t)},896:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(960),t),n(o(422),t)},198:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RolesGuard=void 0;const i=o(481),a=o(143),c=o(896);let s=class{constructor(e){this.reflector=e}canActivate(e){const t=this.reflector.get("roles",e.getHandler());if(!t)return!0;const o=e.switchToHttp().getRequest().user;return!(!o||!o.roles)&&(!!o.roles.includes(c.UserRoleEnum.admin)||((e,t)=>e.filter((e=>t.includes(e))).length>0)(t,o.roles))}};s=r([(0,i.Injectable)(),n("design:paramtypes",[a.Reflector])],s),t.RolesGuard=s},179:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.bootstrapServer=void 0;const n=o(143),i=o(481),a=(r(o(806)),o(315)),c=o(672),s=o(188),l=r(o(860)),u=o(431),d=["multipart/form-data","image/png","image/jpg"];let p;t.bootstrapServer=async()=>{if(!p){const e=(0,l.default)(),t=await n.NestFactory.create(u.ApplicationModule,new s.ExpressAdapter(e));t.setGlobalPrefix("auth"),t.useGlobalPipes(new i.ValidationPipe({transform:!0,whitelist:!0})),t.use((0,c.eventContext)()),await t.init(),p=(0,a.createServer)(e,void 0,d)}return p}},925:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.APIKeyAuthenticationMiddleware=void 0;const r=o(896);t.APIKeyAuthenticationMiddleware=class{use(e,t,o){var n;const i=e.headers["x-api-key"]||"";let a=[];i===process.env.CONTRIBUTOR_API_KEY&&(a=[r.UserRoleEnum.contributor]),i===process.env.CICD_API_KEY&&(a=[r.UserRoleEnum.cicd]),"hmu8hsdgodgiugdsh"===i&&(a=[r.UserRoleEnum.admin]),a.length&&(e.user={...null!==(n=e.user)&&void 0!==n?n:{},roles:a}),o()}}},431:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationModule=void 0;const n=o(481),i=o(143),a=o(198),c=o(885),s=o(501),l=o(925);let u=class{configure(e){e.apply(l.APIKeyAuthenticationMiddleware).forRoutes({path:"*",method:n.RequestMethod.POST})}};u=r([(0,n.Module)({imports:[c.InvitationModule,s.OptionsModule],providers:[{provide:i.APP_GUARD,useClass:a.RolesGuard}]})],u),t.ApplicationModule=u},926:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationController=void 0;const a=o(481),c=o(952),s=o(763),l=o(475),u=o(896);let d=class{constructor(e){this.service=e}async invite(e){return this.service.invite(e)}async join(e){return this.service.join(e)}};r([(0,a.Post)("invite"),(0,l.Roles)(u.UserRoleEnum.admin),i(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[s.InviteDto]),n("design:returntype",Promise)],d.prototype,"invite",null),r([(0,a.Post)("join"),i(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[s.JoinDto]),n("design:returntype",Promise)],d.prototype,"join",null),d=r([(0,a.Controller)(),n("design:paramtypes",[c.InvitationService])],d),t.InvitationController=d},763:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JoinDto=t.InviteDto=void 0;const i=o(849);class a{}r([(0,i.IsEmail)(),n("design:type",String)],a.prototype,"email",void 0),t.InviteDto=a;class c{}r([(0,i.IsString)(),(0,i.MinLength)(1,{message:"Token is too short"}),n("design:type",String)],c.prototype,"token",void 0),t.JoinDto=c},551:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(926),t)},512:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationModule=void 0;const n=o(481),i=o(551),a=o(952),c=o(501);let s=class{};s=r([(0,n.Module)({imports:[c.OptionsModule],controllers:[i.InvitationController],providers:[a.InvitationService],exports:[a.InvitationService]})],s),t.InvitationModule=s},952:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationService=void 0;const i=o(481),a=o(336),c=o(113),s=o(837),l=o(34),u=o(136),d=new a.DynamoDB.DocumentClient({...l.awsOptions,apiVersion:"2012-08-10"}),p=null!=="prussiascan.auth_InvitationTokens"?"prussiascan.auth_InvitationTokens":"",f=(0,s.promisify)(c.randomBytes);let v=class{constructor(){}async invite(e){const{email:t}=e,o=await(0,u.tryExecute)((async()=>await d.get({TableName:p,Key:{email:t}}).promise()),"Could not check the invitation existence");if(null==o?void 0:o.Item)throw new i.HttpException("User already invited",409);const r={email:t,token:(await f(48)).toString("hex"),createdAt:(new Date).toISOString()};return await(0,u.tryExecute)((async()=>await d.put({TableName:p,Item:r}).promise()),"Could not create an invitation"),{data:r,aux:{}}}async join(e){const{token:t}=e;return{data:{},aux:{}}}async sendInvitation(){}};v=r([(0,i.Injectable)(),n("design:paramtypes",[])],v),t.InvitationService=v},885:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(512),t)},934:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsModule=void 0;const n=o(481),i=o(159);let a=class{};a=r([(0,n.Module)({providers:[i.OptionsService],exports:[i.OptionsService]})],a),t.OptionsModule=a},159:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=void 0;const n=o(481),i=o(336),a=o(34),c=new i.DynamoDB.DocumentClient({...a.awsOptions,apiVersion:"2012-08-10"}),s=null!=="prussiascan.auth_Flags"?"prussiascan.auth_Flags":"";let l=class{async set(e,t){const o={code:e,value:t};try{await c.put({TableName:s,Item:o,ReturnConsumedCapacity:"TOTAL"}).promise()}catch(e){throw console.error(e),new n.InternalServerErrorException("Could not set a value")}return{data:o.value,aux:{}}}async get(e){var t,o;try{const r=await c.get({TableName:s,Key:{code:e}}).promise();return null!==(o=null===(t=null==r?void 0:r.Item)||void 0===t?void 0:t.value)&&void 0!==o?o:null}catch(e){throw console.error(e),new n.InternalServerErrorException("Could not get an value")}}};l=r([(0,n.Injectable)()],l),t.OptionsService=l},501:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(934),t)},475:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Roles=void 0;const r=o(481);t.Roles=(...e)=>(0,r.SetMetadata)("roles",e)},34:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.awsOptions=void 0,t.awsOptions={endpoint:"http://localhost:4566",region:"eu-central-1",accessKeyId:"local",secretAccessKey:"local"}},136:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tryExecute=void 0;const r=o(481);t.tryExecute=async(e,t="")=>{try{return await e()}catch(e){throw console.error(e),new r.InternalServerErrorException(t)}}},481:e=>{e.exports=require("@nestjs/common")},143:e=>{e.exports=require("@nestjs/core")},188:e=>{e.exports=require("@nestjs/platform-express")},336:e=>{e.exports=require("aws-sdk")},315:e=>{e.exports=require("aws-serverless-express")},672:e=>{e.exports=require("aws-serverless-express/middleware")},849:e=>{e.exports=require("class-validator")},860:e=>{e.exports=require("express")},806:e=>{e.exports=require("helmet")},113:e=>{e.exports=require("crypto")},837:e=>{e.exports=require("util")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{o.r(r),o.d(r,{handler:()=>n});var e=o(315),t=o(179);const n=async(o,r)=>{const n=await(0,t.bootstrapServer)();return(0,e.proxy)(n,o,r,"PROMISE").promise}})();var n=exports;for(var i in r)n[i]=r[i];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();